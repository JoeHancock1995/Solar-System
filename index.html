<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Solar System App</title>

    <!-- Babylon.js -->
    <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/ammo.js"></script>
    <script src="https://preview.babylonjs.com/cannon.js"></script>
    <script src="https://preview.babylonjs.com/Oimo.js"></script>
    <script src="https://preview.babylonjs.com/libktx.js"></script>
    <script src="https://preview.babylonjs.com/earcut.min.js"></script>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>
    <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>

    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>

<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");

        var engine = null;
        var scene = null;
        var createDefaultEngine = function () { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true }); };

    //CODE BELOW TO HELP WITH HOW TO BREAK THE CREATE SCENE FUNCTION IN TO SMALLER MORE MANAGEABLE FUNCTIONS----------//
        //THIS IS FROM A THREE JS VERSION-----------------------------------------------------------------------------//
            
            // // For orbit
            //     var marker, spline;
            //     var matrix = new THREE.Matrix4();
            //     var up = new THREE.Vector3(0, 1, 0);
            //     var axis = new THREE.Vector3();

            //     // Planet Orbit Variable Declaration
            //     var mercpath, venpath, earthpath, moonpath, marspath, juppath, satpath, urapath, neppath;

            //     var planobj = [];
            //     var pathobj = [];
            //     // the getPoint starting variable - !important - You get me ;)
            //     var mt = vet = eat = mat = jupt = satt = urat = nept = 0;
            //     // Ellipse class, which extends the virtual base class Curve
            //     function Ellipse(xRadius, yRadius) {
            //         THREE.Curve.call(this);
            //         // add radius as a property
            //         this.xRadius = xRadius;
            //         this.yRadius = yRadius;
            //     }

            //     Ellipse.prototype = Object.create(THREE.Curve.prototype);
            //     Ellipse.prototype.constructor = Ellipse;

            //     // define the getPoint function for the subClass
            //     Ellipse.prototype.getPoint = function (t) {

            //         var radians = 2 * Math.PI * t;

            //         return new THREE.Vector3(this.xRadius * Math.cos(radians),
            //             0,
            //             this.yRadius * Math.sin(radians));

            //     };
//--------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------------------------------------------------------------------------//

        function createScene() {
            var scene = new BABYLON.Scene(engine);
            var camera = new BABYLON.UniversalCamera("camera", new BABYLON.Vector3(4.2, 0, 4.2), scene);
            // // This targets the camera to scene origin
            camera.setTarget(BABYLON.Vector3.Zero());
            // This attaches the camera to the canvas
            camera.attachControl(canvas, true);
            // camera.setTarget(BABYLON.Vector3.Zero());
            // camera.pinchPrecision = 100.0;
            // camera.panningSensibility = 0.0;
            // camera.wheelDeltaPercentage = 0.001;
            // camera.lowerBetaLimit = 0.1;
            // // camera.upperBetaLimit = (Math.PI / 2) * 1;
            // camera.lowerRadiusLimit = .01;

            // Create a particle system
            var surfaceParticles = new BABYLON.ParticleSystem("surfaceParticles", 1600, scene);

            // Texture of each particle
            surfaceParticles.particleTexture = new BABYLON.Texture("https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/ParticleSystems/Sun/T_SunSurface.png", scene);

            // Create core sphere
            var sun = BABYLON.MeshBuilder.CreateSphere("sun", { diameter: 20.01, segments: 64 }, scene); // surfaceParticles min/ max and sunEmitter.radius must be changed relative to diameter

            // Create core material
            var coreMat = new BABYLON.StandardMaterial("coreMat", scene)
            coreMat.emissiveColor = new BABYLON.Color3(0.3773, 0.0930, 0.0266);

            // Assign core material to sphere
            sun.material = coreMat;
            // Pre-warm
            surfaceParticles.preWarmStepOffset = 10;
            surfaceParticles.preWarmCycles = 100;
            // Initial rotation
            surfaceParticles.minInitialRotation = -2 * Math.PI;
            surfaceParticles.maxInitialRotation = 2 * Math.PI;
            // Where the sun particles come from
            var sunEmitter = new BABYLON.SphereParticleEmitter();
            sunEmitter.radius = 10;
            sunEmitter.radiusRange = 0; // emit only from shape surface

            // Assign particles to emitters
            surfaceParticles.emitter = sun; // the starting object, the emitter
            surfaceParticles.particleEmitterType = sunEmitter;

            // Color gradient over time
            surfaceParticles.addColorGradient(0, new BABYLON.Color4(0.8509, 0.4784, 0.1019, 0.0));
            surfaceParticles.addColorGradient(0.4, new BABYLON.Color4(0.6259, 0.3056, 0.0619, 0.5));
            surfaceParticles.addColorGradient(0.5, new BABYLON.Color4(0.6039, 0.2887, 0.0579, 0.5));
            surfaceParticles.addColorGradient(1.0, new BABYLON.Color4(0.3207, 0.0713, 0.0075, 0.0));

            surfaceParticles.minSize = 5; // Size of each particle (random between...
            surfaceParticles.maxSize = 8;
            surfaceParticles.minLifeTime = 8.0; // Life time of each particle (random between...
            surfaceParticles.maxLifeTime = 8.0;
            surfaceParticles.emitRate = 200; // Emission rate
            surfaceParticles.blendMode = BABYLON.ParticleSystem.BLENDMODE_ADD; // Blend mode : BLENDMODE_ONEONE, BLENDMODE_STANDARD, or BLENDMODE_ADD
            surfaceParticles.gravity = new BABYLON.Vector3(0, 0, 0); // Set the gravity of all particles
            // Angular speed, in radians
            surfaceParticles.minAngularSpeed = -0.4;
            surfaceParticles.maxAngularSpeed = 0.4;
            // Speed
            surfaceParticles.minEmitPower = 0;
            surfaceParticles.maxEmitPower = 0;
            surfaceParticles.updateSpeed = 0.005;
            surfaceParticles.isBillboardBased = false; // No billboard
            surfaceParticles.start(); // Start the particle system

            var mercury = BABYLON.MeshBuilder.CreateSphere("mercury", { diameterX: .74, diameterY: .74, diameterZ: .74 }, scene);
            mercury.position.x = 22;
            mercury.parent = sun;
            var mercuryMaterial = new BABYLON.StandardMaterial("mercuryMaterial");
            mercuryMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/mercury.png");;
            mercury.material = mercuryMaterial;
            var alpha = Math.PI; //animations

            var venus = BABYLON.MeshBuilder.CreateSphere("venus", { diameterX: 1.7, diameterY: 1.7, diameterZ: 1.7 }, scene);
            venus.position.x = 48;
            venus.parent = sun;
            var venusMaterial = new BABYLON.StandardMaterial("venusMaterial");
            venusMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/venus.png");;
            venus.material = venusMaterial;
            var alpha = Math.PI;


            var earth = BABYLON.MeshBuilder.CreateSphere("earth", { diameterX: 1.7, diameterY: 1.7, diameterZ: 1.7 }, scene);
            earth.position.x = 60;
            earth.parent = sun;
            var earthMaterial = new BABYLON.StandardMaterial("venusMaterial");
            earthMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/earth.png");;
            earth.material = earthMaterial;
            var alpha = Math.PI;


            scene.beforeRender = function () {
                venus.position = new BABYLON.Vector3(48 * Math.sin(alpha), venus.parent.position.y, 48 * Math.cos(alpha));
                venus.rotation.y += .03;
                alpha += 0.002;
                earth.position = new BABYLON.Vector3(60 * Math.sin(alpha), earth.parent.position.y, 60 * Math.cos(alpha));
                earth.rotation.y += .03;
                alpha += 0.01;
            };

            var mars = BABYLON.MeshBuilder.CreateSphere("mars", { diameterX: .92, diameterY: .92, diameterZ: .92 }, scene);
            var marsMaterial = new BABYLON.StandardMaterial("marsMaterial");
            marsMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/mars.png");;
            mars.material = marsMaterial;
            mars.parent = sun;

            var jupiter = BABYLON.MeshBuilder.CreateSphere("jupiter", { diameterX: 20.3, diameterY: 20.3, diameterZ: 20.3 }, scene);
            var jupiterMaterial = new BABYLON.StandardMaterial("jupiterMaterial");
            jupiterMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/jupiter.png");;
            jupiter.material = jupiterMaterial;
            jupiter.parent = sun;

            var saturn = BABYLON.MeshBuilder.CreateSphere("saturn", { diameterX: 16.7, diameterY: 16.7, diameterZ: 16.7 }, scene);
            var saturnMaterial = new BABYLON.StandardMaterial("saturnMaterial");
            saturnMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/saturn.png");;
            saturn.material = saturnMaterial;
            saturn.parent = sun;
            //Array of points to construct a spiral with lines
            var saturnPoints = [];

            var deltaTheta = 0.1;
            var deltaY = 0.000;

            var radius = 1;
            var theta = 0;
            var Y = 0;
            for (var i = 0; i < 64; i++) {
                saturnPoints.push(new BABYLON.Vector3(radius * Math.cos(theta), Y, radius * Math.sin(theta)));
                theta += deltaTheta;
                Y += deltaY
            }

            //Create lines 
            var saturnLines = BABYLON.MeshBuilder.CreateLines("saturnLines", { points: saturnPoints, updatable: true }, scene);

            // Re-set points data and re-draw Lines
            saturnPoints = [];

            deltaTheta = 0.1;
            var deltaY = 0.000;

            radius = 1;
            theta = 0;
            Y = 0;
            for (var i = 0; i < 400; i++) { //number of iterations stays the same
                saturnPoints.push(new BABYLON.Vector3(radius * Math.cos(theta), Y, radius * Math.sin(theta)));
                theta += deltaTheta;
                Y += deltaY
            }

            //Update lines 
            saturnLines = BABYLON.MeshBuilder.CreateLines("saturnLines", { points: saturnPoints, instance: saturnLines }, scene);


            var uranus = BABYLON.MeshBuilder.CreateSphere("uranus", { diameterX: 7.4, diameterY: 7.4, diameterZ: 7.4 }, scene);
            var uranusMaterial = new BABYLON.StandardMaterial("uranusMaterial");
            uranusMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/uranus.png");;
            uranus.material = uranusMaterial;
            uranus.position = sun;

            var neptune = BABYLON.MeshBuilder.CreateSphere("neptune", { diameterX: 5.6, diameterY: 5.6, diameterZ: 5.6 }, scene);
            var neptuneMaterial = new BABYLON.StandardMaterial("neptuneMaterial");
            neptuneMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/neptune.png");;
            neptune.material = neptuneMaterial;
            neptune.position = sun;

            sun.position = new BABYLON.Vector3(0, 0, 0);
            mercury.position = new BABYLON.Vector3(26, 0, 26);
            venus.position = new BABYLON.Vector3(48, 0, 48);
            earth.position = new BABYLON.Vector3(60, 0, 60);
            mars.position = new BABYLON.Vector3(96, 0, 96);
            jupiter.position = new BABYLON.Vector3(312, 0, 312);
            saturn.position = new BABYLON.Vector3(577, 0, 577);
            uranus.position = new BABYLON.Vector3(1154, 0, 1154);
            neptune.position = new BABYLON.Vector3(1789, 0, 1789);


            // Skybox
            var skybox = BABYLON.Mesh.CreateBox("skyBox", 5000.0, scene);
            var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
            skyboxMaterial.backFaceCulling = false; //change backface culling back to false to display skybox.
            skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("./assets/textures/skybox", scene);
            skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
            skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
            skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
            skyboxMaterial.disableLighting = true;
            skybox.material = skyboxMaterial;

            scene.gravity = new BABYLON.Vector3(0, -9.81, 0);
            camera.applyGravity = false;
            camera.ellipsoid = new BABYLON.Vector3(.00002, .00004, .00002);
            scene.collisionsEnabled = true;
            camera.checkCollisions = true;

            // skybox.checkCollisions = true;
            sun.checkCollisions = false;
            mercury.checkCollisions = true;
            venus.checkCollisions = true;
            earth.checkCollisions = true;
            mars.checkCollisions = true;
            jupiter.checkCollisions = true;
            saturn.checkCollisions = true;
            uranus.checkCollisions = true;
            neptune.checkCollisions = true;

            var sunMaterial = new BABYLON.StandardMaterial("sunMaterial");
            sunMaterial.ambientTexture = new BABYLON.Texture("./assets/textures/sun.png");;
            sun.material = sunMaterial;

            var light = new BABYLON.PointLight("Omni0", sun.position, scene);
            light.difuse = new BABYLON.Color3(0, 0, 0);

            // var alpha = 0;
            // var animation1 = new BABYLON.Animation("tutoAnimation", "scaling.z", 30, BABYLON.Animation.ANIMATIONTYPE_FLOAT,
            //     BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);

            scene.registerBeforeRender(function () {
                mercury.position.x = 26 * Math.cos(alpha);
                mercury.parent.rotation.y += 0.0017;
                mercury.position.z =26 * Math.sin(alpha);
                alpha = 0.005;

                // mercury.position = new BABYLON.Vector3(26 * Math.sin(alpha), planet.parent.position.y, 26 * Math.cos(alpha));
                // mercury.rotation.y += .03;
                // alpha += 0.005;
                // moon.position = planet.position;
                // moon.rotation.y -= .1;

                venus.position.x = 48 * Math.cos(alpha);
                venus.parent.rotation.y += 0.0041;
                venus.position.z = 48 * Math.sin(alpha);
                alpha = 0.002;

                // earth.position.x = 60 * Math.cos(alpha);
                // earth.parent.rotation.y += 0.005;
                // earth.position.z = 60 * Math.sin(alpha);
                // alpha += 0.001;

                // mars.position.x = 96 * Math.cos(alpha);
                // mars.rotation.y += 0.009;
                // mars.position.z = 96 * Math.sin(alpha);
                // alpha += 0.0005;

                // jupiter.position.x = 312 * Math.cos(alpha);
                // jupiter.rotation.y += 0.025;
                // jupiter.position.z = 312 * Math.sin(alpha);
                // alpha += 0.0001;

                // saturn.position.x = 577 * Math.cos(alpha);
                // saturn.rotation.y += 0.022;
                // saturn.position.z = 577 * Math.sin(alpha);
                // // alpha += 0.00003;

                // uranus.position.x = 1154 * Math.cos(alpha);
                // uranus.rotation.y += 0.015;
                // uranus.position.z = 1154 * Math.sin(alpha);
                // alpha += 0.000001;

                // neptune.position.x = 1789 * Math.cos(alpha);
                // neptune.rotation.y += 0.013;
                // neptune.position.z = 1789 * Math.sin(alpha);
                // alpha += 0.001;
            });

            return scene;
        };

        engine = createDefaultEngine();
        if (!engine) throw 'engine should not be null.';
        scene = createScene();

        engine.runRenderLoop(function () {
            if (scene) {
                scene.render();
            }
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>

</html>